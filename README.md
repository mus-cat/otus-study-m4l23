# Сбор и анализ логов
## Задание выполнялось с использованием VirtualBox 6.1.40, использовался vagrant с box-образом generic/debian11 (debian 11.6)
## Задание
  - В **Vagrant** настроить 2 машины - `web` и `log`  
  - На `web` поднимаем **nginx** и настраиваем аудит, следящий за изменением конфигов **nginx**. При этом:  \
    Все критичные логи с `web` должны собираться и локально и удаленно.  \
    Все логи с nginx должны уходить на удаленный сервер (локально только критичные).  \
    Логи аудита должны также уходить на удаленную систему.
  - На `log` настраивается центральный лог сервер на любой системе на выбор:  \
    **journald**  \
    **rsyslog**  \
    **elk**  

## Результат
Подготовлены следующие файлы:
- **Vagrant** - настройка и запуск двух ВМ;
- **start.yml** - файл для **ansible** содержаший общие действия для дальнейшей настройки ВМ;
- директории **web** и **logger** - содержат файлы необходимые для спцифической настройки каждой конкретной ВМ.

## Пояснения
В качестве системы для перенаправления логов на центральный сервер и последующего их разобра на сервере применялся **rsyslog**.  
На машине `web` сообщения порождаемые **nginx** и **auditd** собирались с ипользованием модула **rsyslog** - `imfile`.  \
Сообщения с приоритетом **crit** и выше извлекались из потока сообщений получаемых **rsyslog** через сокет с использованием селектора `*.crit`.  \
На машине `logger` осущетвляется получение сообщений чере сеть (используется протокол **udp**) и последующий их анализ. В результате в папке **/var/log/remote** создается папка с именем удаленной машины с которой приходят сообщения (в нашем случае папка называется **web**), внутри которой, по мере поступления сообщений, формируются файлы:  
- **nginx_error.log**
- **nginx_access.log**
- **audit.log**
- **critical.log**

## Замечания
1. В задании сказано, что на машине `web` для **nginx** должны оставаться только критические сообщения, в данной реализации остаются все логи.
2. Есть не нулевая вероятность, что ВМ в процессе их создания Vagrant отвалятся и как следствие не будут корректно настроены. Проблема со службой собирающей модули ядра для VirtuslBoxGuest.
    
